<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ç–∞–ª–æ–≥ —é–≤–µ–ª–∏—Ä–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        /* –®–∞–ø–∫–∞ */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        /* –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã */
        .filters {
            background: white;
            padding: 2rem;
            margin: 2rem auto;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5568d3;
        }
        
        .filter-chips {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .filter-group label {
            font-weight: 500;
            margin-right: 0.5rem;
            align-self: center;
        }
        
        /* –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ */
        .controls {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            align-items: end;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #666;
            font-size: 0.9rem;
        }
        
        .control-group select,
        .control-group input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
        }
        
        .price-range {
            display: flex;
            gap: 0.5rem;
            align-items: end;
        }
        
        .price-range input {
            flex: 1;
        }
        
        .apply-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            white-space: nowrap;
        }
        
        .apply-btn:hover {
            background: #5568d3;
        }
        
        .chip {
            padding: 8px 16px;
            background: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: #333;
        }
        
        .chip:hover {
            background: #e0e0e0;
        }
        
        .chip.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin: 2rem auto;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .product-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .product-info {
            padding: 1.5rem;
        }
        
        .product-category {
            color: #667eea;
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0.5rem 0;
            color: #333;
        }
        
        .product-article {
            color: #999;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .product-material {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
        }
        
        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
        }
        
        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }
        
        .product-factory {
            font-size: 0.85rem;
            color: #999;
        }
        
        .stock-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .in-stock {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .out-stock {
            background: #ffebee;
            color: #c62828;
        }
        
        .no-products {
            text-align: center;
            padding: 4rem 2rem;
            color: #999;
        }
        
        .no-products h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin: 3rem auto;
            flex-wrap: wrap;
        }
        
        .pagination a,
        .pagination span {
            padding: 10px 16px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s;
        }
        
        .pagination a:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .pagination .current {
            background: #667eea;
            color: white;
            border-color: #667eea;
            font-weight: 600;
        }
        
        .pagination .disabled {
            opacity: 0.3;
            pointer-events: none;
        }
        
        .results-info {
            text-align: center;
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }
        
        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
        }
    </style>
</head>
<body>
<header>
    <div class="container">
        <h1>üíé –Æ–≤–µ–ª–∏—Ä–Ω—ã–π –ö–∞—Ç–∞–ª–æ–≥</h1>
        <p class="subtitle">–ò–∑–¥–µ–ª–∏—è –æ—Ç –ª—É—á—à–∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π</p>
        
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div style="text-align: right; margin-top: 1rem;">
            {% if user.is_authenticated %}
                <a href="{% url 'catalog:favorites_list' %}" style="color: white; text-decoration: none; margin-right: 1rem;">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
                {% if user.factory %}
                    <a href="{% url 'catalog:factory_dashboard' %}" style="color: white; text-decoration: none; margin-right: 1rem;">üè≠ –ö–∞–±–∏–Ω–µ—Ç</a>
                {% endif %}
                <a href="{% url 'catalog:logout' %}" style="color: white; text-decoration: none;">üö™ –í—ã—Ö–æ–¥</a>
            {% else %}
                <a href="{% url 'catalog:customer_register' %}" style="color: white; text-decoration: none; margin-right: 1rem;">üë§ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                <a href="{% url 'catalog:login' %}" style="color: white; text-decoration: none;">üîê –í—Ö–æ–¥</a>
            {% endif %}
        </div>
    </div>
</header>

    <div class="container">
        <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
        <div class="filters">
            <form method="get" class="search-box">
                <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª—É..." value="{{ search_query|default:'' }}">
                <button type="submit" class="btn">üîç –ù–∞–π—Ç–∏</button>
            </form>
            
            <div class="filter-chips">
                <div class="filter-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
                    <a href="?" class="chip {% if not current_category %}active{% endif %}">–í—Å–µ</a>
                    {% for category in categories %}
                        <a href="?category={{ category.slug }}" class="chip {% if current_category == category.slug %}active{% endif %}">
                            {{ category.name }}
                        </a>
                    {% endfor %}
                </div>
            </div>
            
            <div class="filter-chips" style="margin-top: 1rem;">
                <div class="filter-group">
                    <label>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</label>
                    <a href="?" class="chip {% if not current_material %}active{% endif %}">–í—Å–µ</a>
                    {% for material in materials %}
                        <a href="?material={{ material.id }}" class="chip {% if current_material == material.id|stringformat:'s' %}active{% endif %}">
                            {{ material.name }}
                        </a>
                    {% endfor %}
                </div>
            </div>
            
            <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ -->
            <form method="get" class="controls">
                <!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
                {% if current_category %}<input type="hidden" name="category" value="{{ current_category }}">{% endif %}
                {% if current_material %}<input type="hidden" name="material" value="{{ current_material }}">{% endif %}
                {% if search_query %}<input type="hidden" name="search" value="{{ search_query }}">{% endif %}
                
                <div class="control-group">
                    <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                    <select name="sort" onchange="this.form.submit()">
                        <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>–ù–æ–≤—ã–µ</option>
                        <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>–¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                        <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>–¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                        <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>–¶–µ–Ω–∞ –æ—Ç ($):</label>
                    <input type="number" name="min_price" placeholder="–ú–∏–Ω" value="{{ min_price|default:'' }}">
                </div>
                
                <div class="control-group">
                    <label>–¶–µ–Ω–∞ –¥–æ ($):</label>
                    <input type="number" name="max_price" placeholder="–ú–∞–∫—Å" value="{{ max_price|default:'' }}">
                </div>
                
                <button type="submit" class="apply-btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </form>
        </div>

        <!-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ -->
        {% if page_obj %}
            <div class="results-info">
                –ü–æ–∫–∞–∑–∞–Ω–æ {{ page_obj.start_index }}‚Äì{{ page_obj.end_index }} –∏–∑ {{ page_obj.paginator.count }} —Ç–æ–≤–∞—Ä–æ–≤
            </div>
            
            <div class="products-grid">
                {% for product in page_obj %}
                    <a href="{% url 'catalog:product_detail' product.article %}" class="product-card">
                        {% if product.images.all.0 %}
                            <img src="{{ product.images.all.0.image.url }}" alt="{{ product.name }}" class="product-image">
                        {% else %}
                            <div class="product-image"></div>
                        {% endif %}
                        
                        <div class="product-info">
                            <div class="product-category">{{ product.category.name }}</div>
                            <h3 class="product-name">{{ product.name }}</h3>
                            <div class="product-article">–ê—Ä—Ç: {{ product.article }}</div>
                            <div class="product-material">{{ product.material.name }} ‚Ä¢ {{ product.weight }} –≥</div>
                            
                            {% if product.in_stock %}
                                <span class="stock-badge in-stock">‚úì –í –Ω–∞–ª–∏—á–∏–∏</span>
                            {% else %}
                                <span class="stock-badge out-stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                            {% endif %}
                            
                            <div class="product-footer">
                                <div class="product-price">{{ product.price }} $</div>
                                <div class="product-factory">{{ product.factory.name }}</div>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            </div>
            
            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            {% if page_obj.has_other_pages %}
            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?page=1{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}">¬´ –ü–µ—Ä–≤–∞—è</a>
                    <a href="?page={{ page_obj.previous_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}">‚Äπ –ù–∞–∑–∞–¥</a>
                {% else %}
                    <span class="disabled">¬´ –ü–µ—Ä–≤–∞—è</span>
                    <span class="disabled">‚Äπ –ù–∞–∑–∞–¥</span>
                {% endif %}
                
                <span class="current">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>
                
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}">–í–ø–µ—Ä—ë–¥ ‚Ä∫</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
                {% else %}
                    <span class="disabled">–í–ø–µ—Ä—ë–¥ ‚Ä∫</span>
                    <span class="disabled">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</span>
                {% endif %}
            </div>
            {% endif %}
        {% else %}
            <div class="no-products">
                <h2>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h2>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
            </div>
        {% endif %}
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 –Æ–≤–µ–ª–∏—Ä–Ω—ã–π –ö–∞—Ç–∞–ª–æ–≥. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π —é–≤–µ–ª–∏—Ä–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π</p>
        </div>
    </footer>
</body>
</html>