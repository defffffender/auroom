{% extends 'catalog/base.html' %}
{% load static %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —é–≤–µ–ª–∏—Ä–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/catalog.css' %}">
{% endblock %}

{% block header_title %}–Æ–≤–µ–ª–∏—Ä–Ω—ã–π –ö–∞—Ç–∞–ª–æ–≥{% endblock %}

{% block content %}
<!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
<div class="filters">
    <form method="get" class="search-box">
        <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª—É..." value="{{ search_query|default:'' }}">
        <button type="submit" class="btn">üîç –ù–∞–π—Ç–∏</button>
    </form>
    
    <div class="filter-chips">
        <div class="filter-group">
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
            <a href="?" class="chip {% if not current_category %}active{% endif %}">–í—Å–µ</a>
            {% for category in categories %}
                <a href="?category={{ category.slug }}" class="chip {% if current_category == category.slug %}active{% endif %}">
                    {{ category.name }}
                </a>
            {% endfor %}
        </div>
    </div>
    
    <div class="filter-chips" style="margin-top: 1rem;">
        <div class="filter-group">
            <label>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</label>
            <a href="?" class="chip {% if not current_material %}active{% endif %}">–í—Å–µ</a>
            {% for material in materials %}
                <a href="?material={{ material.id }}" class="chip {% if current_material == material.id|stringformat:'s' %}active{% endif %}">
                    {{ material.name }}
                </a>
            {% endfor %}
        </div>
    </div>

    <div class="filter-chips" style="margin-top: 1rem;">
        <div class="filter-group">
            <label>–ü—Ä–æ–±—ã:</label>
            <a href="?" class="chip {% if not current_purity %}active{% endif %}">–í—Å–µ</a>
            {% for purity in purities %}
                <a href="?purity={{ purity.id }}" class="chip {% if current_purity == purity.id|stringformat:'s' %}active{% endif %}">
                    {{ purity.value }}
                </a>
            {% endfor %}
        </div>
    </div>

    <div class="filter-chips" style="margin-top: 1rem;">
        <div class="filter-group">
            <label>–¶–≤–µ—Ç–∞ –º–µ—Ç–∞–ª–ª–æ–≤:</label>
            <a href="?" class="chip {% if not current_metal_color %}active{% endif %}">–í—Å–µ</a>
            {% for color in metal_colors %}
                <a href="?metal_color={{ color.id }}" class="chip {% if current_metal_color == color.id|stringformat:'s' %}active{% endif %}">
                    {{ color.name }}
                </a>
            {% endfor %}
        </div>
    </div>

    <div class="filter-chips" style="margin-top: 1rem;">
        <div class="filter-group">
            <label>–°—Ç–∏–ª–∏:</label>
            <a href="?" class="chip {% if not current_style %}active{% endif %}">–í—Å–µ</a>
            {% for style in styles %}
                <a href="?style={{ style.id }}" class="chip {% if current_style == style.id|stringformat:'s' %}active{% endif %}">
                    {{ style.name }}
                </a>
            {% endfor %}
        </div>
    </div>

    <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ -->
    <form method="get" class="controls">
        <!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
        {% if current_category %}<input type="hidden" name="category" value="{{ current_category }}">{% endif %}
        {% if current_material %}<input type="hidden" name="material" value="{{ current_material }}">{% endif %}
        {% if search_query %}<input type="hidden" name="search" value="{{ search_query }}">{% endif %}
        
        <div class="control-group">
            <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
            <select name="sort" onchange="this.form.submit()">
                <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>–ù–æ–≤—ã–µ</option>
                <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>–¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>–¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                <option value="name" {% if sort_by == 'name' %}selected{% endif %}>–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>–¶–µ–Ω–∞ –æ—Ç ($):</label>
            <input type="number" name="min_price" placeholder="–ú–∏–Ω" value="{{ min_price|default:'' }}">
        </div>
        
        <div class="control-group">
            <label>–¶–µ–Ω–∞ –¥–æ ($):</label>
            <input type="number" name="max_price" placeholder="–ú–∞–∫—Å" value="{{ max_price|default:'' }}">
        </div>
        
        <button type="submit" class="btn apply-btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </form>
</div>

<!-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ -->
{% if page_obj %}
    <div class="results-info">
        –ü–æ–∫–∞–∑–∞–Ω–æ {{ page_obj.start_index }}‚Äì{{ page_obj.end_index }} –∏–∑ {{ page_obj.paginator.count }} —Ç–æ–≤–∞—Ä–æ–≤
    </div>
    
    <div class="products-grid">
        {% for product in page_obj %}
            <a href="{% url 'catalog:product_detail' product.article %}" class="product-card">
                {% if product.images.all.0 %}
                    <img src="{{ product.images.all.0.image.url }}" alt="{{ product.name }}" class="product-image">
                {% else %}
                    <div class="product-image"></div>
                {% endif %}
                
                <div class="product-info">
                    <div class="product-category">{{ product.category.name }}</div>
                    <h3 class="product-name">{{ product.name }}</h3>
                    <div class="product-article">–ê—Ä—Ç: {{ product.article }}</div>
                    <div class="product-material">{{ product.material.name }} ‚Ä¢ {{ product.weight }} –≥</div>
                    
                    {% if product.in_stock %}
                        <span class="stock-badge in-stock">‚úì –í –Ω–∞–ª–∏—á–∏–∏</span>
                    {% else %}
                        <span class="stock-badge out-stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                    {% endif %}
                    
                    <div class="product-footer">
                        <div class="product-price">{{ product.price }} $</div>
                        <div class="product-factory">{{ product.factory.name }}</div>
                    </div>
                </div>
            </a>
        {% endfor %}
    </div>
    
    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}">¬´ –ü–µ—Ä–≤–∞—è</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}">‚Äπ –ù–∞–∑–∞–¥</a>
        {% else %}
            <span class="disabled">¬´ –ü–µ—Ä–≤–∞—è</span>
            <span class="disabled">‚Äπ –ù–∞–∑–∞–¥</span>
        {% endif %}
        
        <span class="current">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}">–í–ø–µ—Ä—ë–¥ ‚Ä∫</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
        {% else %}
            <span class="disabled">–í–ø–µ—Ä—ë–¥ ‚Ä∫</span>
            <span class="disabled">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</span>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <div class="empty-state">
        <h2>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h2>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
    </div>
{% endif %}
{% endblock %}