{% extends 'catalog/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Каталог ювелирных изделий" %}{% endblock %}

{% block header_title %}{% trans "Ювелирный Каталог" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/infinite-scroll.css' %}">
{% endblock %}

{% block content %}
<div id="catalogTop"></div>
<!-- Компактная система фильтров -->
<div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm p-4 mb-6">
    <!-- Заголовок и кнопка "Очистить все" -->
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
            <i class="bi bi-funnel text-primary-600 mr-2"></i>
            {% trans "Фильтры" %}
        </h2>
        {% if current_category or current_material or current_purity or current_metal_color or current_style or min_price or max_price or search_query %}
        <a href="?" class="text-sm font-medium text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 flex items-center">
            <i class="bi bi-x-circle mr-1"></i>
            {% trans "Очистить все" %}
        </a>
        {% endif %}
    </div>

    <!-- Строка поиска и фильтров -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-3 mb-4">
        <!-- Поиск -->
        <div class="lg:col-span-2">
            <form method="get" class="flex">
                <input type="search" name="search" value="{{ search_query|default:'' }}" class="block p-2 w-full text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 rounded-l-lg border border-gray-300 dark:border-gray-600 focus:ring-primary-500 focus:border-primary-500" placeholder="{% trans 'Поиск по названию или артикулу...' %}">
                <button type="submit" class="p-2 text-sm font-medium text-white bg-primary-600 rounded-r-lg border border-primary-600 hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300">
                    <i class="bi bi-search"></i>
                </button>
            </form>
        </div>

        <!-- Категории -->
        <div>
            <button id="categoryDropdown" data-dropdown-toggle="categoryDropdownMenu" class="w-full text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-3 py-2 text-center inline-flex items-center justify-between" type="button">
                <span class="flex items-center text-left overflow-hidden">
                    <i class="bi bi-tag mr-2 flex-shrink-0"></i>
                    <span class="truncate">{% if selected_category %}{{ selected_category.name }}{% else %}{% trans "Категории" %}{% endif %}</span>
                </span>
                <i class="bi bi-chevron-down ml-2 flex-shrink-0"></i>
            </button>
            <div id="categoryDropdownMenu" class="z-10 hidden bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700 rounded-lg shadow w-44 border border-gray-200 dark:border-gray-700">
                <ul class="py-2 text-sm text-gray-700 dark:text-gray-200 max-h-60 overflow-y-auto" aria-labelledby="categoryDropdown">
                    <li>
                        <a href="?" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if not current_category %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">{% trans "Все" %}</a>
                    </li>
                    {% for category in categories %}
                    <li>
                        <a href="?category={{ category.slug }}{% if current_material %}&material={{ current_material }}{% endif %}{% if current_purity %}&purity={{ current_purity }}{% endif %}{% if current_metal_color %}&metal_color={{ current_metal_color }}{% endif %}{% if current_style %}&style={{ current_style }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if current_category == category.slug %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">
                            {{ category.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Материалы -->
        <div>
            <button id="materialDropdown" data-dropdown-toggle="materialDropdownMenu" class="w-full text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-3 py-2 text-center inline-flex items-center justify-between" type="button">
                <span class="flex items-center text-left overflow-hidden">
                    <i class="bi bi-gem mr-2 flex-shrink-0"></i>
                    <span class="truncate">{% if selected_material %}{{ selected_material.name }}{% else %}{% trans "Материалы" %}{% endif %}</span>
                </span>
                <i class="bi bi-chevron-down ml-2 flex-shrink-0"></i>
            </button>
            <div id="materialDropdownMenu" class="z-10 hidden bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700 rounded-lg shadow w-44 border border-gray-200 dark:border-gray-700">
                <ul class="py-2 text-sm text-gray-700 dark:text-gray-200 max-h-60 overflow-y-auto" aria-labelledby="materialDropdown">
                    <li>
                        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if not current_material %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">{% trans "Все" %}</a>
                    </li>
                    {% for material in materials %}
                    <li>
                        <a href="?material={{ material.id }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_purity %}&purity={{ current_purity }}{% endif %}{% if current_metal_color %}&metal_color={{ current_metal_color }}{% endif %}{% if current_style %}&style={{ current_style }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if current_material == material.id|stringformat:'s' %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">
                            {{ material.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Пробы -->
        <div>
            <button id="purityDropdown" data-dropdown-toggle="purityDropdownMenu" class="w-full text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-3 py-2 text-center inline-flex items-center justify-between" type="button">
                <span class="flex items-center text-left overflow-hidden">
                    <i class="bi bi-award mr-2 flex-shrink-0"></i>
                    <span class="truncate">{% if selected_purity %}{{ selected_purity.value }}{% else %}{% trans "Пробы" %}{% endif %}</span>
                </span>
                <i class="bi bi-chevron-down ml-2 flex-shrink-0"></i>
            </button>
            <div id="purityDropdownMenu" class="z-10 hidden bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700 rounded-lg shadow w-44 border border-gray-200 dark:border-gray-700">
                <ul class="py-2 text-sm text-gray-700 dark:text-gray-200 max-h-60 overflow-y-auto" aria-labelledby="purityDropdown">
                    <li>
                        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_material %}material={{ current_material }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if not current_purity %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">{% trans "Все" %}</a>
                    </li>
                    {% for purity in purities %}
                    <li>
                        <a href="?purity={{ purity.id }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if current_metal_color %}&metal_color={{ current_metal_color }}{% endif %}{% if current_style %}&style={{ current_style }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if current_purity == purity.id|stringformat:'s' %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">
                            {{ purity.value }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Цвета металлов -->
        <div>
            <button id="metalColorDropdown" data-dropdown-toggle="metalColorDropdownMenu" class="w-full text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-3 py-2 text-center inline-flex items-center justify-between" type="button">
                <span class="flex items-center text-left overflow-hidden">
                    <i class="bi bi-palette mr-2 flex-shrink-0"></i>
                    <span class="truncate">{% if selected_metal_color %}{{ selected_metal_color.name }}{% else %}{% trans "Цвет металла" %}{% endif %}</span>
                </span>
                <i class="bi bi-chevron-down ml-2 flex-shrink-0"></i>
            </button>
            <div id="metalColorDropdownMenu" class="z-10 hidden bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700 rounded-lg shadow w-44 border border-gray-200 dark:border-gray-700">
                <ul class="py-2 text-sm text-gray-700 dark:text-gray-200 max-h-60 overflow-y-auto" aria-labelledby="metalColorDropdown">
                    <li>
                        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_material %}material={{ current_material }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if not current_metal_color %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">{% trans "Все" %}</a>
                    </li>
                    {% for color in metal_colors %}
                    <li>
                        <a href="?metal_color={{ color.id }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if current_purity %}&purity={{ current_purity }}{% endif %}{% if current_style %}&style={{ current_style }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if current_metal_color == color.id|stringformat:'s' %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">
                            {{ color.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Стили -->
        <div>
            <button id="styleDropdown" data-dropdown-toggle="styleDropdownMenu" class="w-full text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-3 py-2 text-center inline-flex items-center justify-between" type="button">
                <span class="flex items-center text-left overflow-hidden">
                    <i class="bi bi-brush mr-2 flex-shrink-0"></i>
                    <span class="truncate">{% if selected_style %}{{ selected_style.name }}{% else %}{% trans "Стили" %}{% endif %}</span>
                </span>
                <i class="bi bi-chevron-down ml-2 flex-shrink-0"></i>
            </button>
            <div id="styleDropdownMenu" class="z-10 hidden bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700 rounded-lg shadow w-44 border border-gray-200 dark:border-gray-700">
                <ul class="py-2 text-sm text-gray-700 dark:text-gray-200 max-h-60 overflow-y-auto" aria-labelledby="styleDropdown">
                    <li>
                        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_material %}material={{ current_material }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if not current_style %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">{% trans "Все" %}</a>
                    </li>
                    {% for style in styles %}
                    <li>
                        <a href="?style={{ style.id }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if current_purity %}&purity={{ current_purity }}{% endif %}{% if current_metal_color %}&metal_color={{ current_metal_color }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 {% if current_style == style.id|stringformat:'s' %}bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400{% endif %}">
                            {{ style.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- Вторая строка: Цена и Сортировка -->
    <form method="get" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3">
        <!-- Сохраняем текущие фильтры -->
        {% if current_category %}<input type="hidden" name="category" value="{{ current_category }}">{% endif %}
        {% if current_material %}<input type="hidden" name="material" value="{{ current_material }}">{% endif %}
        {% if current_purity %}<input type="hidden" name="purity" value="{{ current_purity }}">{% endif %}
        {% if current_metal_color %}<input type="hidden" name="metal_color" value="{{ current_metal_color }}">{% endif %}
        {% if current_style %}<input type="hidden" name="style" value="{{ current_style }}">{% endif %}
        {% if search_query %}<input type="hidden" name="search" value="{{ search_query }}">{% endif %}

        <div class="lg:col-span-2">
            <select name="sort" onchange="this.form.submit()" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2">
                <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>{% trans "Сортировка: Новые" %}</option>
                <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>{% trans "Цена: по возрастанию" %}</option>
                <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>{% trans "Цена: по убыванию" %}</option>
                <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>{% trans "Популярные" %}</option>
                <option value="name" {% if sort_by == 'name' %}selected{% endif %}>{% trans "По алфавиту" %}</option>
            </select>
        </div>

        <div>
            <input type="number" name="min_price" value="{{ min_price|default:'' }}" placeholder="{% trans 'Цена от ($)' %}" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2">
        </div>

        <div>
            <input type="number" name="max_price" value="{{ max_price|default:'' }}" placeholder="{% trans 'Цена до ($)' %}" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2">
        </div>

        <div>
            <button type="submit" class="w-full text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-4 py-2">
                <i class="bi bi-check-circle mr-1"></i> {% trans "Применить" %}
            </button>
        </div>
    </form>

    <!-- Активные фильтры (теги) -->
    {% if current_category or current_material or current_purity or current_metal_color or current_style or min_price or max_price %}
    <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
        <span class="text-sm text-gray-600 dark:text-gray-400 flex items-center mr-2">
            {% trans "Активные фильтры:" %}
        </span>

        {% if selected_category %}
        <a href="?{% if current_material %}material={{ current_material }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="inline-flex items-center px-3 py-1 text-sm font-medium text-primary-800 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30 rounded-full hover:bg-primary-200 dark:hover:bg-primary-900/50">
            <i class="bi bi-tag mr-1"></i>
            {{ selected_category.name }}
            <i class="bi bi-x ml-1"></i>
        </a>
        {% endif %}

        {% if selected_material %}
        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="inline-flex items-center px-3 py-1 text-sm font-medium text-blue-800 dark:text-blue-300 bg-blue-100 dark:bg-blue-900/30 rounded-full hover:bg-blue-200 dark:hover:bg-blue-900/50">
            <i class="bi bi-gem mr-1"></i>
            {{ selected_material.name }}
            <i class="bi bi-x ml-1"></i>
        </a>
        {% endif %}

        {% if selected_purity %}
        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_material %}material={{ current_material }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="inline-flex items-center px-3 py-1 text-sm font-medium text-green-800 dark:text-green-300 bg-green-100 dark:bg-green-900/30 rounded-full hover:bg-green-200 dark:hover:bg-green-900/50">
            <i class="bi bi-award mr-1"></i>
            {{ selected_purity.value }}
            <i class="bi bi-x ml-1"></i>
        </a>
        {% endif %}

        {% if selected_metal_color %}
        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_material %}material={{ current_material }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="inline-flex items-center px-3 py-1 text-sm font-medium text-purple-800 dark:text-purple-300 bg-purple-100 dark:bg-purple-900/30 rounded-full hover:bg-purple-200 dark:hover:bg-purple-900/50">
            <i class="bi bi-palette mr-1"></i>
            {{ selected_metal_color.name }}
            <i class="bi bi-x ml-1"></i>
        </a>
        {% endif %}

        {% if selected_style %}
        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_material %}material={{ current_material }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="inline-flex items-center px-3 py-1 text-sm font-medium text-orange-800 dark:text-orange-300 bg-orange-100 dark:bg-orange-900/30 rounded-full hover:bg-orange-200 dark:hover:bg-orange-900/50">
            <i class="bi bi-brush mr-1"></i>
            {{ selected_style.name }}
            <i class="bi bi-x ml-1"></i>
        </a>
        {% endif %}

        {% if min_price %}
        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_material %}material={{ current_material }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if max_price %}max_price={{ max_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="inline-flex items-center px-3 py-1 text-sm font-medium text-gray-800 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600">
            <i class="bi bi-currency-dollar mr-1"></i>
            От ${{ min_price }}
            <i class="bi bi-x ml-1"></i>
        </a>
        {% endif %}

        {% if max_price %}
        <a href="?{% if current_category %}category={{ current_category }}&{% endif %}{% if current_material %}material={{ current_material }}&{% endif %}{% if current_purity %}purity={{ current_purity }}&{% endif %}{% if current_metal_color %}metal_color={{ current_metal_color }}&{% endif %}{% if current_style %}style={{ current_style }}&{% endif %}{% if min_price %}min_price={{ min_price }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="inline-flex items-center px-3 py-1 text-sm font-medium text-gray-800 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600">
            <i class="bi bi-currency-dollar mr-1"></i>
            До ${{ max_price }}
            <i class="bi bi-x ml-1"></i>
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>

<!-- Каталог товаров -->
{% if page_obj %}
    <!-- Информация о результатах -->
    <div class="flex items-center p-4 mb-4 text-sm text-blue-800 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-300 dark:border-blue-800" role="alert">
        <i class="bi bi-info-circle mr-2"></i>
        <span>{% blocktrans with start=page_obj.start_index end=page_obj.end_index count=page_obj.paginator.count %}Показано {{ start }}–{{ end }} из {{ count }} товаров{% endblocktrans %}</span>
    </div>

    <!-- Сетка товаров с Flowbite Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6" id="productsGrid"
         data-current-page="{{ page_obj.number }}"
         data-total-pages="{{ page_obj.paginator.num_pages }}">
        {% for product in page_obj %}
        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow hover:shadow-lg transition-shadow relative">
            {% if product.images.all.0 %}
            <a href="{% url 'catalog:product_detail' product.article %}">
                <img class="rounded-t-lg h-64 w-full object-contain bg-gray-50 dark:bg-gray-700" src="{{ product.images.all.0.image.url }}" alt="{{ product.name }}" loading="lazy" />
            </a>
            {% else %}
            <div class="rounded-t-lg h-64 bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                <i class="bi bi-image text-gray-400 dark:text-gray-500" style="font-size: 3rem;"></i>
            </div>
            {% endif %}

            <!-- Favorite Button -->
            {% if user.is_authenticated %}
            <button onclick="showFavoriteModalFromCard('{{ product.article }}')"
                    class="absolute top-3 right-3 text-white bg-red-500/80 hover:bg-red-600 backdrop-blur-sm focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-full text-sm p-2 shadow-lg transition"
                    title="{% trans 'Добавить в избранное' %}">
                <i class="bi bi-heart text-lg"></i>
            </button>
            {% else %}
            <button onclick="addToLocalStorageFavorites('{{ product.article }}')"
                    class="absolute top-3 right-3 text-white bg-red-500/80 hover:bg-red-600 backdrop-blur-sm focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-full text-sm p-2 shadow-lg transition"
                    title="{% trans 'Добавить в избранное' %}">
                <i class="bi bi-heart text-lg"></i>
            </button>
            {% endif %}

            <div class="p-5">
                <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300 text-xs font-medium px-2.5 py-0.5 rounded">{{ product.category.name }}</span>

                <a href="{% url 'catalog:product_detail' product.article %}">
                    <h5 class="mt-2 mb-2 text-xl font-bold tracking-tight text-gray-900 dark:text-white hover:text-primary-600">{{ product.name }}</h5>
                </a>

                <p class="mb-3 text-sm text-gray-700 dark:text-gray-300">
                    <i class="bi bi-hash"></i> {% trans "Арт:" %} {{ product.article }}<br>
                    <i class="bi bi-gem"></i> {{ product.material.name }} • {{ product.metal_weight|default:"—" }} {% trans "г" %}
                </p>

                {% if product.in_stock %}
                <span class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300 text-xs font-medium px-2.5 py-0.5 rounded">
                    <i class="bi bi-check-circle"></i> {% trans "В наличии" %}
                </span>
                {% else %}
                <span class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 text-xs font-medium px-2.5 py-0.5 rounded">
                    <i class="bi bi-x-circle"></i> {% trans "Нет в наличии" %}
                </span>
                {% endif %}

                <div class="mt-4">
                    <p class="text-2xl font-bold text-primary-600">${{ product.price }}</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">
                        <i class="bi bi-building"></i> {{ product.factory.name }}
                    </p>
                    <a href="{% url 'catalog:product_detail' product.article %}" class="inline-flex items-center w-full justify-center px-3 py-2 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300">
                        <i class="bi bi-eye mr-2"></i>
                        {% trans "Подробнее" %}
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Sentinel для Intersection Observer (бесконечный скролл) -->
    <div id="scrollSentinel"></div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="hidden">
        <div class="spinner"></div>
        <p class="text-gray-600 dark:text-gray-400">{% trans "Загрузка товаров..." %}</p>
    </div>

    <!-- Кнопка-переключатель пагинации -->
    <button id="paginationToggle" title="{% trans 'Показать/скрыть страницы' %}">
        <i class="bi bi-chevron-left"></i>
    </button>

    <!-- Липкая пагинация справа -->
    <div id="stickyPagination">
        <div class="pagination-header">{% trans "СТРАНИЦЫ" %}</div>

        <!-- Кнопка к первой видимой странице -->
        <button class="nav-btn" id="firstVisiblePageBtn">
            <i class="bi bi-chevron-double-up"></i>
        </button>

        <!-- Кнопка предыдущей страницы -->
        <button class="nav-btn" id="prevPageBtn">
            <i class="bi bi-chevron-up"></i>
        </button>

        <!-- Текущая страница -->
        <div class="current-page text-gray-900 dark:text-white">
            <span id="currentPageNumber">{{ page_obj.number }}</span> / {{ page_obj.paginator.num_pages }}
        </div>

        <!-- Кнопки номеров страниц -->
        <div id="paginationNumbers"></div>

        <!-- Кнопка следующей страницы -->
        <button class="nav-btn" id="nextPageBtn">
            <i class="bi bi-chevron-down"></i>
        </button>

        <!-- Кнопка к последней видимой странице -->
        <button class="nav-btn" id="lastVisiblePageBtn">
            <i class="bi bi-chevron-double-down"></i>
        </button>
    </div>

    <!-- Кнопка "Вернуться к началу" -->
    <button id="scrollToTopBtn" class="hidden" title="{% trans 'Вернуться к началу' %}">
        <i class="bi bi-arrow-up"></i>
    </button>

    <!-- Старая пагинация (скрыта) -->
    {% if page_obj.has_other_pages %}
    <nav class="hidden flex items-center justify-center" aria-label="{% trans 'Page navigation' %}">
        <ul class="inline-flex -space-x-px text-sm">
            {% if page_obj.has_previous %}
            <li>
                <a href="?page=1{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}" class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-e-0 border-gray-300 dark:border-gray-700 rounded-s-lg hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-700 dark:hover:text-white">
                    <i class="bi bi-chevron-double-left"></i>
                </a>
            </li>
            <li>
                <a href="?page={{ page_obj.previous_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-700 dark:hover:text-white">
                    <i class="bi bi-chevron-left"></i>
                </a>
            </li>
            {% else %}
            <li>
                <span class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-300 dark:text-gray-600 bg-white dark:bg-gray-800 border border-e-0 border-gray-300 dark:border-gray-700 rounded-s-lg">
                    <i class="bi bi-chevron-double-left"></i>
                </span>
            </li>
            <li>
                <span class="flex items-center justify-center px-3 h-8 leading-tight text-gray-300 dark:text-gray-600 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700">
                    <i class="bi bi-chevron-left"></i>
                </span>
            </li>
            {% endif %}

            <li>
                <span class="flex items-center justify-center px-3 h-8 text-primary-600 dark:text-primary-400 border border-gray-300 dark:border-gray-700 bg-primary-50 dark:bg-primary-900/30">
                    {% blocktrans with page=page_obj.number total=page_obj.paginator.num_pages %}Страница {{ page }} из {{ total }}{% endblocktrans %}
                </span>
            </li>

            {% if page_obj.has_next %}
            <li>
                <a href="?page={{ page_obj.next_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-700 dark:hover:text-white">
                    <i class="bi bi-chevron-right"></i>
                </a>
            </li>
            <li>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_material %}&material={{ current_material }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-e-lg hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-700 dark:hover:text-white">
                    <i class="bi bi-chevron-double-right"></i>
                </a>
            </li>
            {% else %}
            <li>
                <span class="flex items-center justify-center px-3 h-8 leading-tight text-gray-300 dark:text-gray-600 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700">
                    <i class="bi bi-chevron-right"></i>
                </span>
            </li>
            <li>
                <span class="flex items-center justify-center px-3 h-8 leading-tight text-gray-300 dark:text-gray-600 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-e-lg">
                    <i class="bi bi-chevron-double-right"></i>
                </span>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
{% else %}
    <!-- Пустое состояние -->
    <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm p-12 text-center">
        <i class="bi bi-inbox text-primary-600" style="font-size: 4rem;"></i>
        <h2 class="mt-4 text-2xl font-bold text-gray-900 dark:text-white">{% trans "Товары не найдены" %}</h2>
        <p class="mt-2 text-gray-600 dark:text-gray-400">{% trans "Попробуйте изменить фильтры или поисковый запрос" %}</p>
        <a href="{% url 'catalog:home' %}" class="mt-4 inline-flex items-center px-5 py-3 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300">
            <i class="bi bi-arrow-clockwise mr-2"></i>
            {% trans "Сбросить фильтры" %}
        </a>
    </div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// User authentication status
const userIsAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};
</script>
<script src="{% static 'js/infinite-scroll.js' %}?v=9"></script>

<script>
// Переводы для JavaScript
const translations = {
    addToList: "{% trans 'Добавить в список' %}",
    loading: "{% trans 'Загрузка...' %}",
    createNewList: "{% trans 'Создать новый список' %}",
    listName: "{% trans 'Название списка' %}",
    description: "{% trans 'Описание' %}",
    descriptionOptional: "{% trans 'Описание (опционально)' %}",
    create: "{% trans 'Создать' %}",
    cancel: "{% trans 'Отмена' %}",
    enterListName: "{% trans 'Введите название списка' %}",
    listCreated: "{% trans 'Список создан!' %}",
    errorCreatingList: "{% trans 'Ошибка создания списка' %}",
    errorOccurred: "{% trans 'Произошла ошибка' %}",
    removedFromFavorites: "{% trans 'Удалено из избранного' %}",
    addedToFavorites: "{% trans 'Добавлено в избранное! Войдите, чтобы сохранить навсегда.' %}",
    noListsYet: "{% trans 'У вас пока нет списков' %}",
    createFirstList: "{% trans 'Создайте свой первый список избранного' %}",
    errorLoadingLists: "{% trans 'Ошибка загрузки списков' %}",
    products: "{% trans 'товаров' %}",
    listNamePlaceholder: "{% trans 'Например: Свадебные украшения' %}",
    descriptionPlaceholder: "{% trans 'Описание списка...' %}"
};

let currentArticle = '';

function showFavoriteModalFromCard(article) {
    currentArticle = article;
    const modal = document.getElementById('favoriteListsModal');
    if (!modal) {
        createFavoriteListsModal();
    }
    loadUserFavoriteLists();
    document.getElementById('favoriteListsModal').classList.remove('hidden');
}

function closeFavoriteListsModal() {
    document.getElementById('favoriteListsModal').classList.add('hidden');
}

function createFavoriteListsModal() {
    const modalHTML = `
        <!-- Favorite Lists Modal -->
        <div id="favoriteListsModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50">
            <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[80vh] flex flex-col">
                <!-- Header -->
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                        <i class="bi bi-heart mr-2"></i>${translations.addToList}
                    </h3>
                    <button onclick="closeFavoriteListsModal()" class="text-gray-400 hover:text-gray-900 dark:hover:text-white">
                        <i class="bi bi-x-lg text-xl"></i>
                    </button>
                </div>

                <!-- Lists Container -->
                <div id="favoriteListsContainer" class="flex-1 overflow-y-auto p-4">
                    <div class="text-center text-gray-500">
                        <i class="bi bi-hourglass-split text-3xl"></i>
                        <p>${translations.loading}</p>
                    </div>
                </div>

                <!-- Footer with Create Button -->
                <div class="border-t border-gray-200 dark:border-gray-700 p-4">
                    <button onclick="showCreateListForm()" class="w-full text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                        <i class="bi bi-plus-circle mr-2"></i>${translations.createNewList}
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

function loadUserFavoriteLists() {
    const container = document.getElementById('favoriteListsContainer');

    fetch(`/ru/favorites/toggle/${currentArticle}/`, {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.lists && data.lists.length > 0) {
            let listsHTML = '<div class="space-y-2">';

            data.lists.forEach(list => {
                listsHTML += `
                    <button onclick="addToFavoriteList(${list.id})"
                            class="w-full flex items-center justify-between p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                        <div class="flex items-center">
                            <i class="bi bi-${list.is_default ? 'heart-fill' : 'list-ul'} text-primary-600 mr-3 text-xl"></i>
                            <div class="text-left">
                                <div class="font-medium text-gray-900 dark:text-white">${list.name}</div>
                                <div class="text-xs text-gray-500">${list.items_count} ${translations.products}</div>
                            </div>
                        </div>
                        <i class="bi bi-chevron-right text-gray-400"></i>
                    </button>
                `;
            });

            listsHTML += '</div>';
            container.innerHTML = listsHTML;
        } else {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-8">
                    <i class="bi bi-inbox text-5xl mb-3"></i>
                    <p>${translations.noListsYet}</p>
                    <p class="text-sm">${translations.createFirstList}</p>
                </div>
            `;
        }
    })
    .catch(error => {
        console.error('Error loading lists:', error);
        container.innerHTML = `
            <div class="text-center text-red-500 py-8">
                <i class="bi bi-exclamation-circle text-5xl mb-3"></i>
                <p>${translations.errorLoadingLists}</p>
            </div>
        `;
    });
}

function addToFavoriteList(listId) {
    fetch(`/ru/favorites/toggle/${currentArticle}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: `list_id=${listId}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.is_favorite) {
            showNotification(data.message, 'success');
        } else {
            showNotification(data.message, 'info');
        }
        closeFavoriteListsModal();
    })
    .catch(error => {
        showNotification(translations.errorOccurred, 'error');
    });
}

function showCreateListForm() {
    const container = document.getElementById('favoriteListsContainer');
    container.innerHTML = `
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-900 dark:text-white mb-2">${translations.listName}</label>
                <input type="text" id="newListName"
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                       placeholder="${translations.listNamePlaceholder}">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-900 dark:text-white mb-2">${translations.descriptionOptional}</label>
                <textarea id="newListDescription" rows="3"
                          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                          placeholder="${translations.descriptionPlaceholder}"></textarea>
            </div>
            <div class="flex gap-2">
                <button onclick="createNewList()"
                        class="flex-1 text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    <i class="bi bi-check-lg mr-2"></i>${translations.create}
                </button>
                <button onclick="loadUserFavoriteLists()"
                        class="flex-1 text-gray-900 dark:text-white bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-700 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    <i class="bi bi-x-lg mr-2"></i>${translations.cancel}
                </button>
            </div>
        </div>
    `;
    document.getElementById('newListName').focus();
}

function createNewList() {
    const name = document.getElementById('newListName').value.trim();
    const description = document.getElementById('newListDescription').value.trim();

    if (!name) {
        showNotification(translations.enterListName, 'error');
        return;
    }

    fetch('/favorite-lists/create/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: `name=${encodeURIComponent(name)}&description=${encodeURIComponent(description)}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification(translations.listCreated, 'success');
            loadUserFavoriteLists();
        } else {
            showNotification(data.error || translations.errorCreatingList, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification(translations.errorOccurred, 'error');
    });
}

// LocalStorage favorites for non-authenticated users
function addToLocalStorageFavorites(article) {
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

    if (favorites.includes(article)) {
        favorites = favorites.filter(item => item !== article);
        localStorage.setItem('favorites', JSON.stringify(favorites));
        showNotification(translations.removedFromFavorites, 'info');
    } else {
        favorites.push(article);
        localStorage.setItem('favorites', JSON.stringify(favorites));
        showNotification(translations.addedToFavorites, 'success');
    }
}

// Notification system
function showNotification(message, type = 'info') {
    const colors = {
        'success': 'bg-green-500',
        'error': 'bg-red-500',
        'info': 'bg-blue-500'
    };

    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all`;
    notification.innerHTML = `
        <div class="flex items-center">
            <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
            <span>${message}</span>
        </div>
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Get CSRF token from cookie
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}
